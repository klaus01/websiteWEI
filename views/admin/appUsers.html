<% include header.html %>
<script src="/js/bootstrap-paginator.min.js"></script>
<style type="text/css">
    .table-responsive { margin-top: 20px; }
</style>
<h1 class="page-header">APP用户列表</h1>
<div class="bs-example bs-example-tabs" role="tabpanel" data-example-id="togglable-tabs">
    <ul style="margin-bottom: 15px;" class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"  ><a role="tab" data-toggle="tab" aria-expanded="true"  href="#nickname"             id="nickname-tab"           aria-controls="nickname">昵称</a></li>
        <li role="presentation"                 ><a role="tab" data-toggle="tab" aria-expanded="false" href="#phoneNumber"          id="phoneNumber-tab"        aria-controls="phoneNumber">手机号</a></li>
        <li role="presentation"                 ><a role="tab" data-toggle="tab" aria-expanded="false" href="#isMan"                id="isMan-tab"              aria-controls="isMan">性别</a></li>
        <li role="presentation"                 ><a role="tab" data-toggle="tab" aria-expanded="false" href="#registrationStatus"   id="registrationStatus-tab" aria-controls="registrationStatus">注册状态</a></li>
        <li role="presentation"                 ><a role="tab" data-toggle="tab" aria-expanded="false" href="#registrationTime"     id="registrationTime-tab"   aria-controls="registrationTime">注册时间</a></li>
        <li role="presentation"                 ><a role="tab" data-toggle="tab" aria-expanded="false" href="#loginTime"            id="loginTime-tab"          aria-controls="loginTime">登录时间</a></li>
        <li role="presentation"                 ><a role="tab" data-toggle="tab" aria-expanded="false" href="#lonlatRange"          id="lonlatRange-tab"        aria-controls="lonlatRange">坐标范围</a></li>
    </ul>
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane fade active in" id="nickname" aria-labelledby="nickname-tab">
            <form class="form-inline">
                <div class="form-group">
                    <input type="text" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary" data-loading-text="查询中...">查询</button>
            </form>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="phoneNumber" aria-labelledby="phoneNumber-tab">
            <form class="form-inline">
                <div class="form-group">
                    <input type="text" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary" data-loading-text="查询中...">查询</button>
            </form>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="isMan" aria-labelledby="isMan-tab">
            <form class="form-inline">
                <div class="form-group">
                    <select>
                        <option value="0">女</option>
                        <option value="1">男</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" data-loading-text="查询中...">查询</button>
            </form>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="registrationStatus" aria-labelledby="registrationStatus-tab">
            <form class="form-inline">
                <div class="form-group">
                    <select>
                        <option value="0">手机未验证</option>
                        <option value="1">手机已验证</option>
                        <option value="2">已经完善用户资料</option>
                        <option value="3">已进入应用主页</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" data-loading-text="查询中...">查询</button>
            </form>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="registrationTime" aria-labelledby="registrationTime-tab">
            <form class="form-inline">
                <div class="form-group">
                    <label for="registrationTime-bTime">开始时间</label>
                    <input type="text" class="form-control" id="registrationTime-bTime" placeholder="yyyy-mm-dd hh:nn:ss">
                </div>
                <div class="form-group">
                    <label for="registrationTime-eTime">结束时间</label>
                    <input type="text" class="form-control" id="registrationTime-eTime" placeholder="yyyy-mm-dd hh:nn:ss">
                </div>
                <button type="submit" class="btn btn-primary" data-loading-text="查询中...">查询</button>
            </form>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="loginTime" aria-labelledby="loginTime-tab">
            <form class="form-inline">
                <div class="form-group">
                    <label for="loginTime-bTime">开始时间</label>
                    <input type="text" class="form-control" id="loginTime-bTime" placeholder="yyyy-mm-dd hh:nn:ss">
                </div>
                <div class="form-group">
                    <label for="loginTime-eTime">结束时间</label>
                    <input type="text" class="form-control" id="loginTime-eTime" placeholder="yyyy-mm-dd hh:nn:ss">
                </div>
                <button type="submit" class="btn btn-primary" data-loading-text="查询中...">查询</button>
            </form>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="lonlatRange" aria-labelledby="lonlatRange-tab">
        </div>
    </div>
</div>
<script type="text/javascript">
    var TABLEBEGIN = '\
        <div class="table-responsive">\
            <table class="table table-striped table-hover">\
                <thead>\
                    <tr><th>昵称</th><th>头像</th><th>手机号</th><th>性别</th><th>注册状态</th><th>注册时间</th><th>上次登录时间</th><th>上次登录IP</th><th>上次登录地理信息</th></tr>\
                </thead>\
                <tbody>';
    var TABLEEND = '\
                </tbody>\
            </table>\
            <div><ul name="pages"></ul></div>\
        </div>';
    function search(data, btn, tableContainer){
        btn.button('loading');
        $.ajax({
            type: 'POST',
            url: '/ajax/appUser/search',
            dataType: 'json',
            data: data,
            complete: function() {
                btn.button('reset');
            },
            success: function(result) {
                if (!result.success)
                    return;
                // 清除之前的表格
                var tableDIV = tableContainer.find('.table-responsive');
                if (tableDIV)
                    tableDIV.remove();
                // 生成表格内容
                var newTable = TABLEBEGIN;
                for (var i = 0; i < result.data.rows.length; i++) {
                    var row = result.data.rows[i];
                    newTable = newTable
                    + '<tr>'
                    + '<td>' + row.Nickname + '</td>'
                    + '<td>' + row.IconFileName + '</td>'
                    + '<td>' + row.PhoneNumber + '</td>'
                    + '<td>' + row.IsManDescription + '</td>'
                    + '<td>' + row.RegistrationStatusDescription + '</td>'
                    + '<td>' + row.RegistrationTime + '</td>'
                    + '<td>' + row.LastLoginTime + '</td>'
                    + '<td>' + row.LastLoginIP + '</td>'
                    + '<td>' + row.LastLoginLongitude + '|' + row.LastLoginLatitude + '</td>'
                    + '</tr>';
                }
                newTable += TABLEEND;
                tableContainer.append(newTable);
                // 处理分页
                if (result.data.rows.length > 0) {
                    var pages = tableContainer.find('[name="pages"]');
                    pages.bootstrapPaginator({
                        bootstrapMajorVersion: 3,
                        currentPage: result.data.currentPage,
                        totalPages: result.data.totalPages,
                        onPageClicked: function(e, originalEvent, type, page){
                            if (data.pageNumber === page)
                                return;
                            data.pageNumber = page;
                            search(data, btn, tableContainer);
                        }
                    });
                }
            }
        });
    }
    $('#nickname form').on('submit', function(){
        search({mode: 1, content: $(this).find('input').val(), pageNumber: 1}, $(this).find('button'), $(this).parent());
        return false;
    });
    $('#phoneNumber form').on('submit', function(){
        search({mode: 2, content: $(this).find('input').val(), pageNumber: 1}, $(this).find('button'), $(this).parent());
        return false;
    });
    $('#isMan form').on('submit', function(){
        search({mode: 3, content: $(this).find('select').val(), pageNumber: 1}, $(this).find('button'), $(this).parent());
        return false;
    });
    $('#registrationStatus form').on('submit', function(){
        search({mode: 4, content: $(this).find('select').val(), pageNumber: 1}, $(this).find('button'), $(this).parent());
        return false;
    });
    $('#registrationTime form').on('submit', function(){
        search({mode: 5, bTime: $(this).find('#registrationTime-bTime').val(), eTime: $(this).find('#registrationTime-eTime').val(), pageNumber: 1}, $(this).find('button'), $(this).parent());
        return false;
    });
    $('#loginTime form').on('submit', function(){
        search({mode: 6, bTime: $(this).find('#loginTime-bTime').val(), eTime: $(this).find('#loginTime-eTime').val(), pageNumber: 1}, $(this).find('button'), $(this).parent());
        return false;
    });
//    $('#lonlatRange form').on('submit', function(){
//        search({mode: 7, bTime: $(this).find('#loginTime-bTime').val(), eTime: $(this).find('#loginTime-eTime').val(), pageNumber: 1}, $(this).find('button'), $(this).parent());
//        return false;
//    });
</script>
<% include footer.html %>